<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>–ü—Ä–æ–≥–Ω–æ–∑ –ø–∞—Å—Å–∞–∂–∏—Ä–æ–ø–æ—Ç–æ–∫–∞</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/predict.css') }}">
  <script defer src="{{ url_for('static', filename='js/theme-toggle.js') }}"></script>
</head>
<body>
  <!-- –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —Ç–µ–º—ã -->
  <div class="theme-toggle">
    <button id="toggle-theme">üåô</button>
  </div>

  <div class="predict-page">
    <div class="bg-orbit bg-orbit-1"></div>
    <div class="bg-orbit bg-orbit-2"></div>

    <header class="predict-topbar">
      {% if is_admin %}
        <a href="{{ url_for('dashboard') }}" class="top-back">‚Üê –õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</a>
      {% else %}
        <a href="{{ url_for('index') }}" class="top-back">‚Üê –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞</a>
      {% endif %}

      <div class="top-brand">
        <div class="brand-mark">54</div>
        <div class="brand-text">
          <span class="brand-label">54TrafficInsight</span>
          <span class="brand-sub">–ü—Ä–æ–≥–Ω–æ–∑ –ø–∞—Å—Å–∞–∂–∏—Ä–æ–ø–æ—Ç–æ–∫–∞</span>
        </div>
      </div>
    </header>

    <main class="predict-layout">
      <!-- –õ–µ–≤–∞—è –æ—Å–Ω–æ–≤–Ω–∞—è –∫–∞—Ä—Ç–æ—á–∫–∞ -->
      <section class="predict-main-card">
        <div class="predict-header">
          <div>
            <p class="eyebrow">–ü—Ä–æ–≥–Ω–æ–∑ ‚Ä¢ –°–µ–∑–æ–Ω–Ω–æ—Å—Ç—å ‚Ä¢ –ò–Ω—Ü–∏–¥–µ–Ω—Ç—ã</p>
            <h1>üìà –ü—Ä–æ–≥–Ω–æ–∑ –ø–∞—Å—Å–∞–∂–∏—Ä–æ–ø–æ—Ç–æ–∫–∞ –ø–æ–µ–∑–¥–æ–≤</h1>
            <p class="subtitle">
              –£–∫–∞–∂–∏—Ç–µ –≥–æ–¥ –∏ –º–µ—Å—è—Ü (2016‚Äì2030), –∞ —Å–∏—Å—Ç–µ–º–∞ –ø–æ—Å—Ç—Ä–æ–∏—Ç –ø—Ä–æ–≥–Ω–æ–∑ —Å —É—á—ë—Ç–æ–º
              —Å–µ–∑–æ–Ω–Ω–æ—Å—Ç–∏ –∏ –≤–ª–∏—è–Ω–∏—è –∏–Ω—Ü–∏–¥–µ–Ω—Ç–æ–≤. –ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ –¥–æ—Å—Ç—É–ø–Ω—ã –¥–æ {{ max_real_year }} –≥–æ–¥–∞.
            </p>
          </div>
        </div>

        {% with messages = get_flashed_messages(with_categories=true, category_filter=['pred_success','pred_warning','pred_danger','danger']) %}
          {% if messages %}
            <div class="flash-messages">
              {% for category, message in messages %}
                <div class="flash {{ category }}">{{ message }}</div>
              {% endfor %}
            </div>
          {% endif %}
        {% endwith %}

        <form method="POST" class="predict-form" autocomplete="on">
          <div class="form-row">
            <div class="field">
              <label for="year">–ì–æ–¥</label>
              <input
                id="year"
                type="number"
                name="year"
                min="2016"
                max="2030"
                required
                value="{{ request.form.get('year','') }}"
              >
            </div>

            <div class="field">
              <label for="month">–ú–µ—Å—è—Ü</label>
              <input
                id="month"
                type="number"
                name="month"
                min="1"
                max="12"
                required
                value="{{ request.form.get('month','') }}"
              >
            </div>

            <button type="submit" class="btn-primary">
              –ü–æ—Å—Ç—Ä–æ–∏—Ç—å –ø—Ä–æ–≥–Ω–æ–∑
            </button>
          </div>

          <p class="form-hint">
            –ù–∞–∏–±–æ–ª–µ–µ –Ω–∞–¥—ë–∂–Ω—ã–π –ø—Ä–æ–≥–Ω–æ–∑ –ø–æ–ª—É—á–∞–µ—Ç—Å—è –ø—Ä–∏ –≤—ã–±–æ—Ä–µ –ø–µ—Ä–∏–æ–¥–æ–≤
            –¥–æ {{ max_real_year }} –≥–æ–¥–∞ –≤–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–æ.
          </p>
        </form>

        {% if prediction %}
          {% set year_val = request.form.get('year') %}
          {% set month_val = (request.form.get('month') or 1)|int %}
          <div class="prediction-highlight">
            <div class="prediction-main">
              <p class="prediction-label">–ü—Ä–æ–≥–Ω–æ–∑ –Ω–∞ {{ year_val }}-{{ "%02d"|format(month_val) }}</p>
              <p class="prediction-value">
                {{ prediction | round }} <span>–ø–∞—Å—Å–∞–∂–∏—Ä–æ–≤</span>
              </p>
            </div>
            <p class="prediction-note">
              –ó–Ω–∞—á–µ–Ω–∏–µ –ø–æ–ª—É—á–µ–Ω–æ –Ω–∞ –æ—Å–Ω–æ–≤–µ –ª–∏–Ω–µ–π–Ω–æ–π —Ä–µ–≥—Ä–µ—Å—Å–∏–∏ —Å —É—á—ë—Ç–æ–º —Å–µ–∑–æ–Ω–Ω–æ—Å—Ç–∏ –∏
              –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–æ–≤ –≤–ª–∏—è–Ω–∏—è –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∏–Ω—Ü–∏–¥–µ–Ω—Ç–æ–≤.
            </p>
          </div>
        {% endif %}

        {% if plot_url %}
          <div class="plot-wrapper">
            <div class="plot-header">
              <span class="plot-title">–î–∏–Ω–∞–º–∏–∫–∞ –ø–∞—Å—Å–∞–∂–∏—Ä–æ–ø–æ—Ç–æ–∫–∞ —Å –ø—Ä–æ–≥–Ω–æ–∑–æ–º</span>
              <span class="plot-legend">
                <span class="dot dot-fact"></span> —Ñ–∞–∫—Ç
                <span class="dot dot-forecast"></span> –ø—Ä–æ–≥–Ω–æ–∑
              </span>
            </div>
            <div class="plot-card">
              <img src="data:image/png;base64,{{ plot_url }}" alt="–ì—Ä–∞—Ñ–∏–∫ –ø—Ä–æ–≥–Ω–æ–∑–∞">
            </div>
          </div>
        {% endif %}
      </section>

      <!-- –ü—Ä–∞–≤–∞—è –∫–∞—Ä—Ç–æ—á–∫–∞ —Å –ø–æ–¥—Å–∫–∞–∑–∫–∞–º–∏ / —Ä–µ–∑—é–º–µ -->
      <aside class="predict-side-card">
        <div class="side-glow"></div>
        <h2>–ö–∞–∫ —á–∏—Ç–∞–µ—Ç—Å—è –ø—Ä–æ–≥–Ω–æ–∑</h2>
        <p class="side-desc">
          –ú–æ–¥–µ–ª—å —Å—Ç—Ä–æ–∏—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –ø–∞—Å—Å–∞–∂–∏—Ä–æ–ø–æ—Ç–æ–∫–∞ –æ—Ç –≥–æ–¥–∞, –º–µ—Å—è—Ü–∞ –∏ —Å–µ–∑–æ–Ω–Ω—ã—Ö —Ñ–∞–∫—Ç–æ—Ä–æ–≤,
          –∞ –∑–∞—Ç–µ–º –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Å —É—á—ë—Ç–æ–º –∏–Ω—Ü–∏–¥–µ–Ω—Ç–æ–≤.
        </p>

        <div class="side-metrics">
          {% if prediction %}
            <div class="side-metric">
              <span class="metric-label">–ü–µ—Ä–∏–æ–¥ –ø—Ä–æ–≥–Ω–æ–∑–∞</span>
              <span class="metric-value">
                {{ year_val }}-{{ "%02d"|format(month_val) }}
              </span>
            </div>
            <div class="side-metric">
              <span class="metric-label">–û—Ü–µ–Ω–∫–∞ –ø–æ—Ç–æ–∫–∞</span>
              <span class="metric-value">
                {{ prediction | round }} –ø–∞—Å—Å–∞–∂–∏—Ä–æ–≤
              </span>
            </div>
          {% else %}
            <div class="side-metric">
              <span class="metric-label">–®–∞–≥ 1</span>
              <span class="metric-value">
                –í—ã–±–µ—Ä–∏—Ç–µ –≥–æ–¥ –∏ –º–µ—Å—è—Ü, –Ω–∞ –∫–æ—Ç–æ—Ä—ã–π —Ö–æ—Ç–∏—Ç–µ –ø–æ—Å—Ç—Ä–æ–∏—Ç—å –ø—Ä–æ–≥–Ω–æ–∑.
              </span>
            </div>
            <div class="side-metric">
              <span class="metric-label">–®–∞–≥ 2</span>
              <span class="metric-value">
                –ù–∞–∂–º–∏—Ç–µ ¬´–ü–æ—Å—Ç—Ä–æ–∏—Ç—å –ø—Ä–æ–≥–Ω–æ–∑¬ª –∏ –æ—Ü–µ–Ω–∏—Ç–µ –¥–∏–Ω–∞–º–∏–∫—É –Ω–∞ –≥—Ä–∞—Ñ–∏–∫–µ.
              </span>
            </div>
          {% endif %}
        </div>

        <div class="side-footer">
          <p class="side-footer-title">–° —á–µ–º –ø–æ–º–æ–≥–∞–µ—Ç –ø—Ä–æ–≥–Ω–æ–∑</p>
          <p class="side-footer-text">
            ‚Ä¢ –ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ –ø—Ä–∏–≥–æ—Ä–æ–¥–Ω—ã–µ –∏ –¥–∞–ª—å–Ω–∏–µ —Ä–µ–π—Å—ã.<br>
            ‚Ä¢ –ê–Ω–∞–ª–∏–∑ –≤–ª–∏—è–Ω–∏—è –∏–Ω—Ü–∏–¥–µ–Ω—Ç–æ–≤ –Ω–∞ –ø–∞—Å—Å–∞–∂–∏—Ä–æ–ø–æ—Ç–æ–∫.<br>
            ‚Ä¢ –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –æ—Ç—á—ë—Ç–æ–≤ –ø–æ —É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç–∏ –ø–µ—Ä–µ–≤–æ–∑–æ–∫ –∏ –ò–ë.
          </p>
        </div>
      </aside>
    </main>
  </div>
</body>
</html>
