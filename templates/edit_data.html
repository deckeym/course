<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>–ò–∑–º–µ–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/edit_data.css') }}">
  <script defer src="{{ url_for('static', filename='js/theme-toggle.js') }}"></script>

  <script>
    // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –≥–æ–¥ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏—Ö–æ–¥–∏—Ç —Å —Å–µ—Ä–≤–µ—Ä–∞
    const MAX_REAL_YEAR = parseInt('{{ max_real_year }}', 10);

    function syncMonthMax() {
      const y = document.getElementById('year');
      const m = document.getElementById('month');
      if (!y || !m) return;

      const yearVal = parseInt(y.value || '0', 10);

      // –ù–µ –¥–∞—ë–º –≤–≤–µ—Å—Ç–∏ –≥–æ–¥ –±–æ–ª—å—à–µ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–æ–≥–æ –¥–∏–∞–ø–∞–∑–æ–Ω–∞
      if (yearVal > MAX_REAL_YEAR) {
        y.value = MAX_REAL_YEAR;
      }

      m.max = 12;
    }

    function updatePreview() {
      const y = document.getElementById('year').value;
      const m = document.getElementById('month').value;
      const dateEl = document.getElementById('preview-date');
      const valEl = document.getElementById('preview-value');

      if (!y || !m) {
        dateEl.textContent = '‚Äî';
        valEl.textContent = '–Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö';
        return;
      }

      const key = `${y}-${String(m).padStart(2, '0')}`;
      dateEl.textContent = key;

      const v = DATA_MAP[key];
      valEl.textContent = (v !== undefined) ? v : '–Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö';
    }

    document.addEventListener('DOMContentLoaded', () => {
      syncMonthMax();
      updatePreview();
    });
  </script>

</head>
<body>
<div class="theme-toggle">
  <button id="toggle-theme">üåô</button>
</div>

<div class="edit-page">
  <div class="bg-orbit bg-orbit-1"></div>
  <div class="bg-orbit bg-orbit-2"></div>

  <header class="edit-topbar">
    <a href="{{ url_for('dashboard') }}" class="top-back">‚Üê –õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</a>

    <div class="top-brand">
      <div class="brand-mark">54</div>
      <div class="brand-text">
        <span class="brand-label">54TrafficInsight</span>
        <span class="brand-sub">–†–µ–¥–∞–∫—Ç–æ—Ä –¥–∞–Ω–Ω—ã—Ö</span>
      </div>
    </div>
  </header>

  <main class="edit-layout">
    <section class="edit-main-card">
      <div class="edit-header">
        <p class="eyebrow">–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ ‚Ä¢ –î–∞–Ω–Ω—ã–µ ‚Ä¢ –ö–æ–Ω—Ç—Ä–æ–ª—å</p>
        <h1>–ò–∑–º–µ–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –æ –ø–∞—Å—Å–∞–∂–∏—Ä–æ–ø–æ—Ç–æ–∫–µ</h1>
        <p class="subtitle">
          –£–∫–∞–∂–∏—Ç–µ –≥–æ–¥ –∏ –º–µ—Å—è—Ü (2016‚Äì{{ max_real_year }}), —á—Ç–æ–±—ã —Å–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–∞—Å—Å–∞–∂–∏—Ä–æ–≤ –ø–æ–µ–∑–¥–æ–≤.
          –ò–∑–º–µ–Ω–µ–Ω–∏—è –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –∫ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏–º –¥–∞–Ω–Ω—ã–º, –∫–æ—Ç–æ—Ä—ã–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–ª—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∏ –ø—Ä–æ–≥–Ω–æ–∑–∞.
        </p>
      </div>

      {% with messages = get_flashed_messages(with_categories=true, category_filter=['edit_success','edit_warning','edit_danger']) %}
        {% if messages %}
          <div class="flash-messages">
            {% for category, message in messages %}
              <div class="flash {{ category }}">{{ message }}</div>
            {% endfor %}
          </div>
        {% endif %}
      {% endwith %}

      <div class="edit-grid">
        <form method="POST" class="edit-form" autocomplete="off">
          <div class="field">
            <label for="year">–ì–æ–¥</label>
            <input id="year"
                   type="number"
                   name="year"
                   min="2016"
                   max="{{ max_real_year }}"
                   required
                   value="{{ request.form.get('year','') }}"
                   oninput="syncMonthMax();updatePreview();">
          </div>

          <div class="field">
            <label for="month">–ú–µ—Å—è—Ü</label>
            <input id="month"
                   type="number"
                   name="month"
                   min="1"
                   max="12"
                   required
                   value="{{ request.form.get('month','') }}"
                   oninput="updatePreview();">
          </div>

          <div class="field">
            <label for="passengers">–ù–æ–≤–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–∞—Å—Å–∞–∂–∏—Ä–æ–≤ –ø–æ–µ–∑–¥–æ–≤</label>
            <input id="passengers"
                   type="number"
                   name="passengers"
                   min="0"
                   max="2000"
                   required
                   value="{{ request.form.get('passengers','') }}">
          </div>

          <button type="submit" class="btn-primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è</button>
        </form>

        <aside class="preview-card">
          <div class="preview-header">
            <span class="preview-title">–¢–µ–∫—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ</span>
            <span class="preview-tag">–§–∞–∫—Ç</span>
          </div>
          <div class="preview-line">
            <span id="preview-date" class="preview-date">‚Äî</span>
            <span class="preview-sep">‚Üí</span>
            <span id="preview-value" class="preview-value">–Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö</span>
          </div>
          <p class="preview-hint">
            –ò–∑–º–µ–Ω—è–π—Ç–µ –≥–æ–¥ –∏ –º–µ—Å—è—Ü ‚Äî –∑–¥–µ—Å—å –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –∑–Ω–∞—á–µ–Ω–∏–µ –≤ –±–∞–∑–µ –¥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è.
          </p>
        </aside>
      </div>
    </section>

    <aside class="edit-side-card">
      <div class="side-glow"></div>
      <h2>–ó–∞—á–µ–º –Ω—É–∂–µ–Ω —Ä–µ–¥–∞–∫—Ç–æ—Ä</h2>
      <p class="side-desc">
        –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –º–æ–∂–µ—Ç –≤—Ä—É—á–Ω—É—é —Å–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –ø–∞—Å—Å–∞–∂–∏—Ä–æ–ø–æ—Ç–æ–∫–∞,
        –µ—Å–ª–∏ –∏–∑–º–µ–Ω–∏–ª–∏—Å—å –∏—Å—Ö–æ–¥–Ω—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –∏–ª–∏ –±—ã–ª–∏ –≤—ã—è–≤–ª–µ–Ω—ã –æ—à–∏–±–∫–∏ –≤ —É—á—ë—Ç–µ.
      </p>

      <div class="side-block">
        <h3>–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏</h3>
        <ul>
          <li>–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–æ–ª—å–∫–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥—ë–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è.</li>
          <li>–ò–∑–º–µ–Ω—è–π—Ç–µ –¥–∞–Ω–Ω—ã–µ –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø–µ—Ä–∏–æ–¥–∞ (–¥–æ {{ max_real_year }} –≥–æ–¥–∞).</li>
          <li>–ü–æ—Å–ª–µ –ø—Ä–∞–≤–∫–∏ –ø–µ—Ä–µ–ø—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∏ –ø—Ä–æ–≥–Ω–æ–∑.</li>
        </ul>
      </div>
    </aside>
  </main>
</div>

<script>
  const DATA_MAP = JSON.parse('{{ data_map|tojson|safe }}');
</script>
</body>
</html>
